jobs:
  build:
    runs-on: ${{ matrix.system.image }}
    steps:
      - uses: 'actions/checkout@v6'
      - name: 'Fix pyproject.toml for older Poetry'
        run: python3 .github/scripts/fix_pyproject_for_poetry.py
      - name: 'Build Snap package'
        uses: 'snapcore/action-build@v1'
        id: build
        with:
          snapcraft-args: pack
          snapcraft-channel: 'latest/stable'
      - name: 'Upload Artifacts'
        uses: 'actions/upload-artifact@v6'
        with:
          if-no-files-found: error
          name: clem2itunes-snap-${{ matrix.system.arch }}
          path: '*.snap'
      - name: 'Attest'
        uses: 'actions/attest-build-provenance@v3'
        with:
          subject-path: '*.snap'
      - if: github.ref_type == 'tag'
        name: 'Upload package'
        uses: 'softprops/action-gh-release@v2'
        with:
          fail_on_unmatched_files: true
          files: '*.snap'
    strategy:
      matrix:
        system:
          - { arch: amd64, image: ubuntu-24.04 }
          - { arch: arm64, image: ubuntu-24.04-arm }
name: 'Snap'
'on':
  push:
    branches:
      - 'master'
    tags:
      - 'v*.*.*'
  workflow_dispatch:
permissions:
  attestations: 'write'
  contents: 'write'
  id-token: 'write'
